<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Bảng sản phẩm</title>
  <style>
    table {
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: left;
      color: #ffffff;
    }

    th.sortable {
      cursor: pointer;
      position: relative;
    }

    th.sortable::after {
      content: "";
      position: absolute;
      right: 8px;
    }

    th.sortable.sorted-asc::after {
      content: "▲";
    }

    th.sortable.sorted-desc::after {
      content: "▼";
    }

    .highlight {
      background-color: yellow;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <button id="sortByNameBtn">Sắp xếp theo tên sản phẩm</button>
  <input type="text" id="searchInput" placeholder="Nhập các từ cần tìm">

  <table id="productTable">
    <thead>
      <tr>
        <th>TT</th>
        <th class="sortable" data-col="1">Mã sản phẩm</th>
        <th class="sortable" data-col="2">Tên sản phẩm</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>SP001</td><td>Máy giặt</td></tr>
      <tr><td>2</td><td>SP002</td><td>Bếp đa năng</td></tr>
      <tr><td>3</td><td>SP003</td><td>Lò sưởi</td></tr>
      <tr><td>4</td><td>SP004</td><td>Điều hòa nhiệt độ</td></tr>
      <tr><td>5</td><td>SP005</td><td>Tủ lạnh</td></tr>
    </tbody>
  </table>

  <script>
    const table = document.getElementById('productTable');
    const headers = table.querySelectorAll('th.sortable');
    let sortDirection = {};

    // Hàm sắp xếp chung
    function sortTable(colIndex) {
      // Reset trạng thái các cột
      headers.forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));

      // Đảo chiều sắp xếp
      sortDirection[colIndex] = !sortDirection[colIndex];

      const rows = Array.from(table.tBodies[0].rows);
      rows.sort((a, b) => {
        const cellA = a.cells[colIndex].textContent.trim().toLowerCase();
        const cellB = b.cells[colIndex].textContent.trim().toLowerCase();
        return sortDirection[colIndex]
          ? cellA.localeCompare(cellB)
          : cellB.localeCompare(cellA);
      });

      // Gắn lại vào bảng + cập nhật TT
      rows.forEach((row, i) => {
        row.cells[0].textContent = i + 1;
        table.tBodies[0].appendChild(row);
      });

      // Gắn class để hiển thị mũi tên
      const header = table.querySelector(`th[data-col="${colIndex}"]`);
      if (header) {
        header.classList.add(sortDirection[colIndex] ? 'sorted-asc' : 'sorted-desc');
      }
    }

    // Sự kiện click trên tiêu đề cột
    headers.forEach(header => {
      header.addEventListener('click', () => {
        const colIndex = parseInt(header.dataset.col);
        sortTable(colIndex);
      });
    });

    // Nút "Sắp xếp theo tên sản phẩm" -> cột số 2
    document.getElementById('sortByNameBtn').addEventListener('click', () => {
      sortTable(2);
    });

    // Tìm kiếm realtime
    document.getElementById('searchInput').addEventListener('input', function () {
      const keyword = this.value.trim().toLowerCase();
      const rows = table.tBodies[0].rows;

      for (let row of rows) {
        let found = false;
        for (let i = 1; i < row.cells.length; i++) {
          const cell = row.cells[i];
          const text = cell.textContent;
          const lower = text.toLowerCase();

          if (keyword && lower.includes(keyword)) {
            found = true;
            const regex = new RegExp(`(${keyword})`, 'gi');
            cell.innerHTML = text.replace(regex, '<span class="highlight">$1</span>');
          } else {
            cell.innerHTML = text;
          }
        }
        row.style.display = found || keyword === "" ? "" : "none";
      }
    });
  </script>
</body>
</html>
